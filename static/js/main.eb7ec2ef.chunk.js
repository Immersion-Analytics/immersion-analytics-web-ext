(this["webpackJsonpia-web-extension-react"]=this["webpackJsonpia-web-extension-react"]||[]).push([[0],{54:function(e,t,n){},72:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),s=n(18),o=n.n(s),c=n(36),r=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,90)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),i(e),s(e),o(e)}))},l=n(9),u=n(12),d=n(22),b=n(11),j=(n(54),n(8)),h=n(50),f=n(77),v=n(78),m=n(79),x=n(80),O=n(81),p=n(82),g=n(83),y=n(2),w="#dialog";function k(e,t,n){var a,i=null===(a=S(e))||void 0===a?void 0:a.value;return void 0===i?t:i}function S(e){var t,n;try{n=e()}catch(c){}var i=Object(a.useState)(),s=Object(l.a)(i,2)[1],o=null===(t=n)||void 0===t?void 0:t._netWrapper._id;return Object(a.useEffect)((function(){if(s({}),n)return n.onChanged((function(){s({})}))}),[o]),n}function N(e){try{return JSON.parse(e)}catch(t){return null}}var C=["app"],z=["icon","className"],D=window.IA;function T(){return Object(y.jsx)("span",{children:"\u200b"})}function R(e,t){function n(){var t=e.connectionStateMessage;return t.id=e.connectionState,t}var i=Object(a.useState)(n()),s=Object(l.a)(i,2),o=s[0],c=s[1];return Object(a.useEffect)((function(){return e.onStateChanged((function(){var e=n();c(e),t&&t(e)}))})),o}function I(e){var t=e.app,n=Object(h.a)(e,C),a=R(t.ia),i="label"in e?Object(y.jsx)("span",{children:"Connection Status:\xa0"}):null;return Object(y.jsxs)("span",Object(u.a)(Object(u.a)({style:{color:D.util.iaColorToCSS(a.color)}},n),{},{children:[i,Object(y.jsx)("span",{children:a.message}),Object(y.jsx)(T,{})]}))}function V(e){var t=e.width;void 0===t&&(t=100);var n=t*(454/2048);return Object(y.jsx)(f.a,Object(u.a)({src:"./img/ia-logo-and-text.png",width:t,height:n},e))}var A=function(){return Object(y.jsx)(v.a,{className:"connection-icon"})},L=function(){return Object(y.jsx)(m.a,{className:"visualizations-icon"})},_=function(){return Object(y.jsx)(x.a,{className:"refresh-icon text-success"})},E=function(){return Object(y.jsx)(O.a,{className:"add-icon text-success"})},P=function(){return Object(y.jsx)(p.a,{className:"delete-icon text-danger"})},B=function(){return Object(y.jsx)(v.b,{className:"trash-icon"})},F=function(e){return e.on?Object(y.jsx)(g.a,{className:"eye-icon"}):Object(y.jsx)(g.b,{className:"eye-icon text-muted"})};function U(e){var t,n=e.icon,a=e.className,s=Object(h.a)(e,z);return a="icon-btn "+(null!==(t=a)&&void 0!==t?t:""),Object(y.jsx)(j.Button,Object(u.a)(Object(u.a)({className:a},s),{},{children:i.a.createElement(n)}))}function J(e){var t=e.app;return Object(y.jsx)(U,Object(u.a)({icon:_,onClick:function(){return t.reconnectToLobby()}},e))}function M(e){var t=e.propertyGetter,n=e.validate,i=k(t,""),s=Object(a.useState)(i),o=Object(l.a)(s,2),c=o[0],r=o[1],u=Object(a.useState)(),d=Object(l.a)(u,2),b=d[0],h=d[1];b||c===i||r(i);var f=function(e){return n?n(e):void 0},v=f(c),m=void 0===v&&void 0,x=null!==v&&void 0!==v?v:"\u200b";return Object(y.jsx)(j.TextField,{value:c,onChange:function(e){var n,a=e.target.value;r(a),f(a)||null===(n=t())||void 0===n||n.set(a)},onFocus:function(){return h(!0)},onBlur:function(){return h(!1)},valid:m,message:x,kind:"line"})}var G=n(88),q=n(89);function H(e){var t=e.app,n=Object(a.createRef)(),i=Object(a.useState)(),s=Object(l.a)(i,2),o=s[0],c=s[1],r=Object(a.useState)(),u=Object(l.a)(r,2),d=u[0],b=u[1],h=Object(a.useState)(),f=Object(l.a)(h,2),v=f[0],m=f[1],x=function(e){e.preventDefault(),c(!1);var a=n.current.value;t.provideRoomPassword(d,a)};return t.onRequestRoomPassword=function(e,t){c(!0),b(e),m(t.details)},Object(y.jsxs)(G.a,{id:"pw-input-modal",show:o,onHide:function(){c(!1),t.disconnectRoom()},autoFocus:!1,children:[Object(y.jsx)(G.a.Header,{closeButton:!0,children:Object(y.jsx)(G.a.Title,{children:"Enter Password"})}),Object(y.jsx)(G.a.Body,{children:Object(y.jsx)(q.a,{inline:!0,onSubmit:x,children:Object(y.jsxs)(q.a.Label,{children:[v,":",Object(y.jsx)(q.a.Control,{className:"ml-1 pw-input",type:"password",size:"sm",ref:n,autoFocus:!0})]})})}),Object(y.jsx)(G.a.Footer,{children:Object(y.jsx)(j.Button,{onClick:x,children:"Submit"})})]})}var K=function(e){var t=e.app,n=function(e){var n="".concat(window.location.origin,"/").concat(t.platform.id,"-").concat(e).concat(w);console.log("Opening IA dialog at "+n);t.platform.openDialog(n,{width:500,height:500})};return Object(y.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[Object(y.jsx)(V,{className:"mr-2"}),Object(y.jsxs)(j.Button,{className:"mr-1 mt-1",density:"high",onClick:function(){return n("visualizations")},children:[Object(y.jsx)(L,{}),Object(y.jsx)("span",{children:"\xa0Visualizations"})]}),Object(y.jsxs)(j.Button,{className:"mr-1 mt-1",density:"high",onClick:function(){return n("connection")},children:[Object(y.jsx)(A,{}),Object(y.jsx)("span",{children:"\xa0Connect"})]}),Object(y.jsx)(I,{app:t,className:"mt-1 mx-2 flex-grow-1"})]})},W=n(84),$=n(56),Q=n(85),X=n(86),Y=n(58);var Z=function(e){var t,n,s=e.app,o=R(s.ia),c=function(e){var t=e.id;return"JoiningRoom"===t||"JoinedRoom"===t}(o),r=["Disconnected","ConnectingToLobby","Disconnecting"].includes(o.id),u=Object(a.useState)(),d=Object(l.a)(u,2),b=d[0],h=d[1],f=i.a.createRef(),v=i.a.createRef(),m=Object(a.useState)(),x=Object(l.a)(m,2),O=x[0],g=x[1],w=i.a.createRef();return Object(y.jsxs)(W.a,{id:"ia-connect-panel",children:[Object(y.jsx)(te,{app:s,show:b,setShow:h}),Object(y.jsxs)(Q.a,{borderless:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Runtime Server"}),Object(y.jsxs)("th",{className:"d-flex align-items-center justify-content-end",children:[Object(y.jsxs)(j.Button,{kind:"outline",density:"high",onClick:function(){return h(!0)},children:[Object(y.jsx)(p.b,{}),"\xa0 Set Server Address"]}),Object(y.jsx)(ee,{app:s,onSelect:function(e){return s.reconnectToLobby(e)}}),Object(y.jsx)(J,{className:"ml-2",app:s})]})]})}),Object(y.jsx)("tbody",{children:Object(y.jsxs)("tr",{className:s.ia.lobbyServerUri?"":"text-muted",children:[Object(y.jsx)("td",{children:"Lobby Address"}),Object(y.jsx)("td",{children:null!==(t=s.ia.lobbyServerUri)&&void 0!==t?t:"Not Connected"})]})})]}),Object(y.jsx)("fieldset",{disabled:c,children:Object(y.jsxs)(Q.a,{className:"room-settings fullwidth-inputs",borderless:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsx)("tr",{children:Object(y.jsx)("th",{colSpan:"2",children:"Collaboration Room"})})}),Object(y.jsxs)("tbody",{children:[Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Room Name"}),Object(y.jsx)("td",{children:Object(y.jsx)(j.TextField,{className:"ia-room-name",kind:"line",ref:f})})]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Room Password (optional)"}),Object(y.jsx)("td",{children:Object(y.jsx)(j.TextField,{type:"password",className:"d-block",ref:v})})]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsxs)("div",{className:"d-flex align-items-center",children:[Object(y.jsx)("span",{children:"Enable view-only access"}),Object(y.jsx)(j.Checkbox,{className:"px-2 mb-0",checked:O,onChange:function(e){return g(e.target.checked)}})]})}),Object(y.jsxs)("td",{className:"d-flex align-items-center"+(O?"":" text-muted"),children:[Object(y.jsx)("span",{className:"mr-1",children:"Viewer password"}),Object(y.jsx)(j.TextField,{type:"password",className:"flex-grow-1",ref:w,disabled:!O})]})]})]})]})}),Object(y.jsxs)("div",{className:"d-flex align-items-center",children:[Object(y.jsxs)("span",{className:"flex-grow-1 "+(s.ia.roomServerUri?"":"text-muted"),children:[Object(y.jsx)("span",{className:"d-inline-block",children:"Room Address:"}),Object(y.jsx)("span",{className:"px-2 d-inline-block",children:null!==(n=s.ia.roomServerUri)&&void 0!==n?n:"Not Connected"})]}),Object(y.jsx)(j.Button,{density:"high",className:"flex-shrink-0",onClick:c?function(){return s.disconnectRoom()}:function(e){return s.joinOrCreateRoom(f.current.value,v.current.value,O?w.current.value:null)},disabled:r,children:c?"Disconnect From Room":"Join or Create Room"})]})]})};function ee(e){var t=e.app,n=e.onSelect;return Object(y.jsx)(X.a,{className:"text-input-with-dropdown",title:"",onSelect:n,children:t.getRecentServers().map((function(e){return Object(y.jsx)(Y.a.Item,{eventKey:e.url,children:e.name},e.url)}))})}function te(e){var t=e.show,n=e.setShow,i=e.app,s=Object(a.useState)(i.lastLobbyServerAddress),o=Object(l.a)(s,2),c=o[0],r=o[1],u=function(){return n(!1)},d=R(i.ia,(function(e){["ConnectedToLobby","JoinedRoom"].includes(e.id)&&setTimeout(u,500)})),b=["ConnectingToLobby","ConnectedToLobby","JoiningRoom","JoinedRoom"].includes(d.id),h={onClick:b?function(e){return i.disconnectLobby(!0)}:function(e){return i.reconnectToLobby(c)},content:b?"Disconnect":"Connect"};return Object(y.jsxs)(G.a,{show:t,onHide:u,children:[Object(y.jsx)(G.a.Header,{closeButton:!0,children:Object(y.jsx)(G.a.Title,{children:Object(y.jsx)("h6",{children:"Enter Server Address"})})}),Object(y.jsxs)(G.a.Body,{className:"d-flex align-items-center fullwidth-inputs",children:[Object(y.jsx)(j.TextField,{className:"text-input-with-dropdown flex-grow-1",placeholder:"ws://",onChange:function(e){return r(e.target.value)},value:c}),Object(y.jsx)(ee,{app:i,onSelect:function(e){r(e)}})]}),Object(y.jsxs)(G.a.Footer,{children:[Object(y.jsx)(I,{app:i}),Object(y.jsx)(j.Button,{onClick:u,children:"Close"}),Object(y.jsx)(j.Button,{onClick:h.onClick,kind:"primary",children:h.content})]})]})}var ne=n(87),ae=n(24),ie=n(25),se=window.confirm,oe=2e3,ce=function(){function e(t,n,a){var i=this;Object(ae.a)(this,e),this.platform=t,this.errorCallback=a,console.log("Initialize IA"),this.ia=n,this.scene=this.ia.scene,this.database=this.ia.scene.database,this.ia.onRoomPasswordRequired((function(e,t){return i._handleRoomPasswordRequired(e,t)})),this.lastLobbyServerAddress="",this.onRoomPasswordRequest=null,this._lastRoomPassword=null,this.connectionInfo=null}return Object(ie.a)(e,[{key:"saveConnectionInfo",value:function(){var e,t=JSON.stringify({lobby:{server:this.ia.lobbyServerUri},room:{server:this.ia.roomServerUri,name:null===(e=this.ia.room)||void 0===e?void 0:e.name,password:this._lastRoomPassword}});try{this.platform.saveSettings({"ia-connection-info":t})}catch(n){console.error("Error saving connection settings:",n)}}},{key:"handleSettingsChanged",value:function(e){console.log("Handling settings changed");var t=e["ia-connection-info"];if(t){var n=N(t);n||console.log("Could not read connection info:",t),this.connectionInfo=n,this.retryConnectionInfo()}}},{key:"retryConnectionInfo",value:function(){var e,t,n=this.connectionInfo;if(console.log("Trying connection info:",n),!n)return this.ia.disconnectLobbyServer(),void this.ia.disconnect();var a=null===(e=n.lobby)||void 0===e?void 0:e.server;a!==this.ia.lobbyServerUri&&this.ia.connectToLobbyServer(a);var i,s=null===(t=n.room)||void 0===t?void 0:t.server;s!==this.ia.roomServerUri&&this.ia.connectToRoom(s,null===(i=n.room)||void 0===i?void 0:i.password)}},{key:"_handleError",value:function(e,t){var n="Error ".concat(e);console.error(n,t),this.errorCallback&&this.errorCallback(n,t)}},{key:"reconnectToLobby",value:function(e){e&&(this.lastLobbyServerAddress=e),console.log("Reconnect to lobby: "+this.lastLobbyServerAddress);try{this.ia.connectToLobbyServer(this.lastLobbyServerAddress)}catch(t){this._handleError("connecting to lobby server",t)}}},{key:"disconnectLobby",value:function(){this.ia.disconnectLobbyServer(),this.saveConnectionInfo()}},{key:"disconnectRoom",value:function(){this.ia.disconnect(),this.saveConnectionInfo()}},{key:"getRecentServers",value:function(){return[{url:"ws://localhost:11700",name:"Local Runtime Server"}]}},{key:"joinOrCreateRoom",value:function(e,t,n){this._lastRoomPassword=t,this.ia.joinOrCreateRoom(e,t,n)}},{key:"_handleRoomPasswordRequired",value:function(e,t){this.onRequestRoomPassword&&this.onRequestRoomPassword(e,t)}},{key:"provideRoomPassword",value:function(e,t){this._lastRoomPassword=t,this.ia.provideRoomPassword(e,t)}},{key:"setCurrentVisualizationDataSource",value:function(e){console.log("Set Data Source: "+e.name);var t=this.getSelectedViz();t&&(t.axes.sourceDataset=e.name,this.platform.createTableForDataSource(e))}},{key:"selectViz",value:function(e){var t=this.scene.visualizations.getKey(e);t&&(this.scene.focusedViz=t)}},{key:"getSelectedViz",value:function(){return this.scene.focusedViz}},{key:"_updateMappings",value:function(e,t){if(e){for(var n=e.axes,a=t?n.config.axes:this._axisMappingsTable.rows().data(),i=0;i<a.length;i++){var s=a[i],o=n.getMapping(s.name);s.enabled=!!o&&o.enabled,s.mapping=o?o.variableName:""}this._axisMappingsTable.clear().rows.add(a).draw()}else this._axisMappingsTable.clear().draw()}},{key:"getSelectedDataset",value:function(){var e={},t=e.viz=this.getSelectedViz();if(t){var n=this.ia.scene.database;e.dataset=n.get(t.axes.sourceDataset),e.secondaryDataset=n.get(t.secondaryAxes.sourceDataset)}return e}},{key:"newViz",value:function(){console.log("Create new visualization");var e=this._getUniqueVisualizationName(),t=this.ia.create.ScatterViz(e);this.scene.visualizations.add(t),this.selectViz(e)}},{key:"removeSelectedViz",value:function(){var e=this.scene.focusedViz;e&&(console.log("Remove visualization: "+e.name),this.scene.visualizations.remove(e))}},{key:"_getUniqueVisualizationName",value:function(){var e=this.ia.scene.visualizations,t="New Visualization";if(!e.containsKey(t))return t;t+=" ";for(var n=1;n<1e3;n++){var a=t+n;if(!e.containsKey(a))return a}throw"Too many visualizations"}},{key:"confirmResetScene",value:function(){se("Are you sure you would like to clear this scene and all of its existing visualizations?")&&this.ia.syncEngine.reset()}}]),e}();var re=function(){return Object(y.jsxs)(G.a,{show:!0,className:"text-nowrap",id:"loading-spinner-modal",backdrop:"static",keyboard:!1,children:[Object(y.jsx)("div",{className:"loading-spinner-icon","aria-busy":!0,children:Object(y.jsx)(j.Spinner,{})}),Object(y.jsx)("div",{className:"loading-msg",children:"Loading"})]})};var le=function(e){var t,n=e.app,i=n.scene;k((function(){return i.selection}));var s=k((function(){return i.visualizations})),o=k((function(){return i.focusedViz.axes.sourceDatasetProperty})),c=S((function(){return i.database.get(i.focusedViz.axes.sourceDataset).variables})),r=S((function(){return i.colormaps})),l=k((function(){return i.focusedViz.colormapNameProperty})),u=S((function(){return i.vizSettings.pointSizeProperty}));return Object(a.useEffect)((function(){!i.focusedViz&&(null===s||void 0===s?void 0:s.count)>0&&(i.focusedViz=s.get(0))})),Object(y.jsxs)("div",{className:"container-lg h-100 px-0",children:[Object(y.jsxs)("div",{className:"container-lg",children:[Object(y.jsx)(ue,{app:n,selectedVizName:null===(t=i.focusedViz)||void 0===t?void 0:t.name,vizNames:null===s||void 0===s?void 0:s.keys}),Object(y.jsx)("fieldset",{disabled:!i.focusedViz,children:Object(y.jsx)(Q.a,{borderless:!0,className:"fullwidth-inputs",children:Object(y.jsxs)("tbody",{className:"ia-viz-info",children:[Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Visualization Name:"}),Object(y.jsx)("td",{children:Object(y.jsx)(M,{propertyGetter:function(){var e;return null===(e=i.focusedViz)||void 0===e?void 0:e.nameProperty},validate:function(e){var t=i.focusedViz;if(t)return e?t.name!==e&&i.visualizations.containsKey(e)?"Name already used":void 0:"Name must not be empty"}})})]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Visualization Data Source:"}),Object(y.jsx)("td",{children:Object(y.jsx)(de,{app:n,selectedDatasetName:o})})]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Point Size:"}),Object(y.jsx)("td",{children:Object(y.jsx)("input",{type:"range",className:"custom-range",min:".01",max:".15",step:".001",value:u.value,onChange:function(e){var t=parseFloat(e.target.value);isFinite(t)&&u.set(t)}})})]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:"Colormap:"}),Object(y.jsx)("td",{children:Object(y.jsxs)(j.DropdownSelect,{className:"w-100",onChange:function(e){i.focusedViz&&(i.focusedViz.colormapName=e.target.value)},value:l,children:[Object(y.jsxs)("option",{value:"",children:[" - Default - (",r.defaultColormapName,")"]}),r.availableColormapNames.map((function(e){return Object(y.jsx)("option",{value:e,children:e},e)}))]})})]})]})})})]}),i.focusedViz?Object(y.jsx)(je,{axisGroup:i.focusedViz.axes,onGetDatasetVariables:function(){return null===c||void 0===c?void 0:c.keys},onCheckVariableExists:function(e){return null===c||void 0===c?void 0:c.containsKey(e)}}):Object(y.jsx)("h6",{className:"text-secondary text-center",children:"Please select a visualization"})]})};function ue(e){var t=e.selectedVizName,n=e.vizNames,a=e.app;return Object(y.jsxs)("div",{className:"d-flex justify-content-between",children:[Object(y.jsxs)("div",{children:[Object(y.jsx)(j.DropdownSelect,{value:null!==t&&void 0!==t?t:"",onChange:function(e){return a.selectViz(e.target.value)},children:(null===n||void 0===n?void 0:n.length)>0?n.map((function(e){return Object(y.jsx)("option",{children:e},e)})):Object(y.jsx)("option",{children:"- No Visualizations -"})}),Object(y.jsx)(U,{icon:E,onClick:function(){return a.newViz()}}),Object(y.jsx)(U,{icon:P,onClick:function(){return a.removeSelectedViz()}})]}),Object(y.jsx)("div",{children:Object(y.jsxs)(j.Button,{kind:"lowEmphasis",onClick:function(){return a.confirmResetScene()},children:[Object(y.jsx)(B,{})," Reset Scene"]})})]})}function de(e){var t,n=e.app,a=e.selectedDatasetName,i=S((function(){return n.database.get(a)})),s=null!==(t=null===i||void 0===i?void 0:i.rowCount)&&void 0!==t?t:0,o=null===i||void 0===i?void 0:i.variables.count,c=s===oe;return Object(y.jsxs)(W.a,{children:[Object(y.jsx)(ne.a,{children:Object(y.jsx)(be,Object(u.a)({},e))}),Object(y.jsx)(ne.a,{children:Object(y.jsxs)($.a,{className:"text-right",children:["Rows: ",Object(y.jsx)("span",{className:c?"text-danger":"",children:s}),", Variables: ",o]})})]})}function be(e){var t=e.app,n=e.selectedDatasetName,i=k((function(){return t.database.datasets})),s=Object(a.useState)(),o=Object(l.a)(s,2),c=o[0],r=o[1],u=function(e,t){var n=[];return n.push({sectionHeaderName:"Active Data Sources:"}),e&&(n=n.concat(e.keys.map((function(e){return{name:e}})))),n.push({sectionHeaderName:"Available Data Sources:",enabledLoadingSpinner:!0}),t&&(n=n.concat(t)),n},d=Object(a.useState)(u(i)),b=Object(l.a)(d,2),h=b[0],f=b[1];return Object(y.jsx)(X.a,{title:n||"<Select Data Source>",onClick:function(){r(!0),t.platform.getDataSourcesAsync().then((function(e){var t=u(i,e);f(t),r(!1)}))},className:"flex-grow-1 text-right",children:h.map((function(e,n){return e.sectionHeaderName?Object(y.jsxs)(Y.a.Item,{disabled:!0,children:[e.sectionHeaderName,c&&e.enabledLoadingSpinner?Object(y.jsx)(j.Spinner,{className:"inline-spinner",dimension:15}):null]},n):Object(y.jsx)(Y.a.Item,{onClick:function(){return t.setCurrentVisualizationDataSource(e)},children:e.name},n)}))})}function je(e){var t=e.axisGroup,n=e.onGetDatasetVariables,a=e.onCheckVariableExists;S((function(){return t}));return Object(y.jsxs)(Q.a,{striped:!0,borderless:!0,id:"ia-axis-mappings",children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{}),Object(y.jsx)("th",{children:"Axis"}),Object(y.jsx)("th",{children:"Variable"})]})}),Object(y.jsx)("tbody",{children:t.config.axes.map((function(e){var i=t.getMapping(e.name);return i.axisName=e.name,Object(y.jsx)(he,Object(u.a)(Object(u.a)({},i),{},{axisGroup:t,onGetDatasetVariables:n,onCheckVariableExists:a}),e.name)}))})]})}function he(e){var t=e.axisName,n=e.variableName,i=e.enabled,s=e.onCheckVariableExists,o=e.axisGroup,c=e.onGetDatasetVariables,r=Object(a.useState)(),u=Object(l.a)(r,2),d=u[0],b=u[1],h=n&&!s(n),f=function(e){o.map(t,e),b(void 0)},v=null;n&&(v=Object(y.jsx)(j.Button,{className:"icon-btn",onClick:function(){return o.mappings.setMappingEnabled(t,!i)},disabled:!n,children:Object(y.jsx)(F,{on:i})}));var m=null!==n&&void 0!==n?n:"";return h&&(m+=" <Missing in Dataset>"),Object(y.jsxs)("tr",{className:"ia-axis-mapping-row",children:[Object(y.jsx)("td",{children:v}),Object(y.jsx)("td",{children:t}),Object(y.jsx)("td",{children:Object(y.jsxs)(X.a,{title:m,onClick:function(){return b(c())},size:"lg",className:"ia-axis-mapping"+(h?" missing":""),children:[Object(y.jsx)(Y.a.Item,{onClick:function(){return f(null)},children:"<Unmapped>"},"-"),null===d||void 0===d?void 0:d.map((function(e){return Object(y.jsx)(Y.a.Item,{onClick:function(){return f(e)},children:e},e)}))]})}),Object(y.jsx)("td",{className:"buttons",children:n?Object(y.jsx)(U,{icon:P,onClick:function(){return f(null)}}):null})]})}var fe,ve,me=function(e){var t=Object(b.d)(),n=e.app,a=e.platformId,i=e.panelId,s=[{content:Object(y.jsxs)("span",{children:[Object(y.jsx)(A,{})," Connection"]}),id:"connection",component:function(e){return Object(y.jsx)(Z,Object(u.a)({},e))}},{content:Object(y.jsxs)("span",{children:[Object(y.jsx)(L,{})," Visualizations"]}),id:"visualizations",component:function(e){return Object(y.jsx)(le,Object(u.a)({},e))}}];console.log("current panel: "+i),void 0===i&&(i="");var o={"":0,connection:0,visualizations:1}[i];return void 0===o?Object(y.jsx)("div",{children:"Unknown Panel"}):(console.log("Launching IA Control Panel"),Object(y.jsxs)(W.a,{fluid:!0,className:"d-flex flex-column h-100vh",children:[Object(y.jsxs)("div",{className:"px-2 mb-2 d-flex flex-row",children:[Object(y.jsx)($.a,{children:Object(y.jsx)(V,{})}),Object(y.jsx)($.a,{className:"text-right",children:Object(y.jsx)(I,{app:n})})]}),Object(y.jsx)("div",{className:"flex-column flex-grow-1",children:Object(y.jsx)(j.Tabs,{activation:"manual",onTabChange:function(e){var n=function(e,t){var n="/".concat(e,"-").concat(t);return window.location.hash===w&&(n+=w),n}(a,s[e].id);t.push(n)},selectedTabIndex:o,tabs:s,className:"d-flex flex-column flex-grow-1",children:s[o].component(e)})}),Object(y.jsx)(H,{app:n})]}))},xe=n(59),Oe=window,pe=(Oe.$,Oe.tableau),ge="tableau",ye="tableau",we={bool:"bool",float:"float",int:"int",date:"timestamp","date-time":"timestamp",string:"string",spatial:null},ke=function(){function e(){Object(ae.a)(this,e),this.id=ge,this._datasetBindings={}}return Object(ie.a)(e,[{key:"init",value:function(e,t){var n=this,a=this;this.callbacks=t,this.ia=e,this.database=e.scene.database;var i=window.location.hash===w;pe.extensions.initializeAsync().then((function(){console.log("Tableau JS Initialized"),i||a.database.datasets.onChanged((function(){return a._updateBindings()})),n._handleInitialized()})).catch((function(e){console.error("Tableau initialization error:",e)})),i||this._updateBindings()}},{key:"_handleInitialized",value:function(){var e=this;pe.extensions.settings.addEventListener(pe.TableauEventType.SettingsChanged,(function(t){console.log("Tableau Extension Settings changed"),e.callbacks.onSettingsChanged(t.newSettings)})),this.callbacks.onInitialized(),this.callbacks.onSettingsChanged(pe.extensions.settings.getAll())}},{key:"openDialog",value:function(e,t){pe.extensions.ui.displayDialogAsync(e,null,t).then((function(e){console.log("IA Dialog closed")})).catch((function(e){switch(e.errorCode){case pe.ErrorCodes.DialogClosedByUser:console.log("IA dialog closed by user");break;case pe.ErrorCodes.DialogAlreadyOpen:alert("The Immersion Analytics configuration dialog is already open in another window");break;default:console.error("IA Dialog Error: "+e.message)}}))}},{key:"saveSettings",value:function(e){var t=!1;Object.entries(e).forEach((function(e){var n=Object(l.a)(e,2),a=n[0],i=n[1];i!==pe.extensions.settings.get(a)&&(pe.extensions.settings.set(a,i),t=!0)})),t&&pe.extensions.settings.saveAsync().then((function(){return console.log("IA extension settings saved")})).catch((function(){return console.error("Could not save extension settings")}))}},{key:"createTableForDataSource",value:function(e){var t=e.name,n=this.database.get(t);if(n||(n=this.ia.create.Dataset(t),this.database.datasets.add(n)),n.sourceType===ye){var a=N(n.sourceInfo);if(a&&a.worksheetName===e.worksheetName)return}n.sourceType=e.type,delete e.name,delete e.type,n.sourceInfo=0===Object.keys(e).length?"":JSON.stringify(e),this._updateBindings()}},{key:"_updateBindings",value:function(){var e=this,t=this.database.datasets;for(var n in t.keys.forEach((function(n){console.log("Processing table "+n);var a=t[n];if(!e._datasetBindings[n]&&a.sourceType==ye){var i=N(a.sourceInfo);if(i&&i.worksheetName){var s=e._getTableauWorksheet(i.worksheetName);if(s){var o=new Se(t,s,i.logicalTableId,n);e._datasetBindings[n]=o}else console.log("Worksheet '"+i.worksheetName+"' does not exist in this Tableau dashboard")}}})),this._datasetBindings){if(!t.containsKey(n))this._datasetBindings[n].dispose(),delete this._datasetBindings[n]}}},{key:"getDataSourcesAsync",value:function(){return Promise.all(pe.extensions.dashboardContent.dashboard.worksheets.map(this._getDataSourcesForWorksheetAsync)).then((function(e){var t;return(t=[]).concat.apply(t,Object(xe.a)(e))}))}},{key:"_getDataSourcesForWorksheetAsync",value:function(e){return e.getUnderlyingTablesAsync().then((function(t){return t.map((function(t){return{name:e.name+"/"+t.id,type:ye,worksheetName:e.name,logicalTableId:t.id}})).concat({name:e.name+" (Summary Data)",type:ye,worksheetName:e.name})}))}},{key:"_getTableauWorksheet",value:function(e){return pe.extensions.dashboardContent.dashboard.worksheets.find((function(t){return t.name===e}))}}]),e}(),Se=function(){function e(t,n,a,i){Object(ae.a)(this,e),this.allDatasets=t,this.worksheet=n,this.tableId=a,this.datasetName=i,this._unregisterListenerFunctions=[],console.log("Initializing data binding for "+i),this.updateData()}return Object(ie.a)(e,[{key:"dispose",value:function(){this._unregisterListeners()}},{key:"_unregisterListeners",value:function(){this._unregisterListenerFunctions.forEach((function(e){return e()})),this._unregisterListenerFunctions=[]}},{key:"_registerListeners",value:function(){var e=this;this._unregisterListenerFunctions.push(this.worksheet.addEventListener(pe.TableauEventType.MarkSelectionChanged,(function(){return e.updateData()}))),this._unregisterListenerFunctions.push(this.worksheet.addEventListener(pe.TableauEventType.FilterChanged,(function(){return e.updateData()})))}},{key:"updateData",value:function(){this._unregisterListeners();var e=this;this.getDataAsync().then((function(t){return e.setTableData(t)})).then((function(){return e._registerListeners()}))}},{key:"getDataAsync",value:function(){var e={includeAllColumns:!0,maxRows:2e3};return this.tableId?this.worksheet.getUnderlyingTableDataAsync(this.tableId,e).then(this.formatUnderlyingTableData):this.worksheet.getSummaryDataAsync(e).then(this.formatSummaryTableData)}},{key:"formatUnderlyingTableData",value:function(e){var t=e.data;return e.columns.map((function(e){var n=we[e.dataType];if(!n)return null;var a=e.index;return{name:e.fieldName,type:n,data:t.map((function(e){return e[a].nativeValue}))}}))}},{key:"formatSummaryTableData",value:function(e){var t=e.data,n=e.columns,a={},i=-1,s=-1;n.forEach((function(e){var t=e.fieldName,n=e.index;"Measure Names"==t?i=n:"Measure Values"==t?s=n:a[n]=t}));var o=i>=0&&s>=0,c={},r={};Object.entries(a).forEach((function(e){var t=Object(l.a)(e,2),a=t[0],i=t[1];r[i]=n[a].dataType})),t.forEach((function(e){var t="";for(var n in a)t+="{{"+e[n].formattedValue+"}}";var l=c[t];if(!l)for(var u in l=c[t]={},a)l[a[u]]=e[u].nativeValue;if(o){var d=e[i].formattedValue,b=e[s].nativeValue;l[d]=b,r[d]="float"}}));var u=Object.values(c);return Object.entries(r).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return(a=we[a])?{name:n,type:a,data:u.map((function(e){return e[n]}))}:null}))}},{key:"setTableData",value:function(e){console.log("Dataset update: "+this.datasetName);var t={name:this.datasetName,columns:e.filter((function(e){return e}))},n=this.allDatasets.getKey(this.datasetName);n?n.setData(t):console.error("Warning: trying to update non-existing dataset: "+this.datasetName)}}]),e}(),Ne="web",Ce=function(){function e(){Object(ae.a)(this,e),this.id=Ne}return Object(ie.a)(e,[{key:"init",value:function(e,t){t.onInitialized()}},{key:"openDialog",value:function(e,t){window.location=e}},{key:"getDataSourcesAsync",value:function(){return new Promise((function(e){e([])}))}},{key:"createTableForDataSource",value:function(){}},{key:"saveSettings",value:function(e){}}]),e}(),ze=window.IA,De=(fe={},Object(d.a)(fe,Ne,(function(){return new Ce})),Object(d.a)(fe,ge,(function(){return new ke})),fe),Te="connection",Re=(ve={},Object(d.a)(ve,"overview",(function(e){return Object(y.jsx)(K,Object(u.a)({},e))})),Object(d.a)(ve,Te,(function(e){return Object(y.jsx)(me,Object(u.a)({panelId:"connection"},e))})),Object(d.a)(ve,"visualizations",(function(e){return Object(y.jsx)(me,Object(u.a)({panelId:"visualizations"},e))})),ve);var Ie=function(){var e=Object(a.useState)(),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)(),o=Object(l.a)(s,2),c=o[0],r=o[1],u=Object(a.useState)(!0),d=Object(l.a)(u,2),j=d[0],h=d[1],f=Object(b.d)(),v=function(){var e=Object(b.e)().pathname.split("/");if(e.length<2)return{};var t=e[1].split("-"),n=t.length;return{platformId:n>0?t[0]:void 0,panelId:n>1?t[1]:void 0}}(),m=v.platformId,x=v.panelId,O=De[m];x||(x=Te),console.log("Refreshing IA Web Extension UI"),Object(a.useEffect)((function(){return ze.onReady((function(){n||(console.log("IA ready"),console.assert(!window.ia,"IA client has already been created. Invalid state."),window.ia=ze.createClient(),i(window.ia),function(){if(O){var e=O(),t=new ce(e,window.ia);r(t),e.init(window.ia,{onInitialized:function(){console.log("Platform ".concat(m," ready")),h(!1)},onSettingsChanged:function(e){t.handleSettingsChanged(e)}})}else console.error("Unknown platform: "+m)}())}))}));var p=function(e){"ConnectedToLobby"!==e&&"JoinedRoom"!==e||c.saveConnectionInfo()};Object(a.useEffect)((function(){if(c)return c.ia.onStateChanged(p)}));var g=function(){console.log("Room connection is ready!")};if(Object(a.useEffect)((function(){if(c)return c.ia.onSyncReady(g)})),!De[m])return f.push("/"+Ne),null;if(j)return Object(y.jsx)(re,{});var w,k={app:c,platformId:m},S=Re[x];return S?S(k):((w="Panel")||(w="Page"),Object(y.jsxs)("h3",{children:[w," not found"]}))};o.a.render(Object(y.jsx)(c.a,{children:Object(y.jsx)(Ie,{})}),document.getElementById("root")),r()}},[[72,1,2]]]);
//# sourceMappingURL=main.eb7ec2ef.chunk.js.map